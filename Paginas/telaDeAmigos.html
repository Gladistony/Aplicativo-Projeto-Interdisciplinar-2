<script type="module">
    import { getAuth } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js';
    import { getFirestore, doc, updateDoc, arrayUnion, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';

    const firebaseConfig = {
        apiKey: "AIzaSyBlWq7V4LQ5PJhYIp5ZI-tMnD81fnt7XTI",
        authDomain: "monitoria-projeto-2.firebaseapp.com",
        projectId: "monitoria-projeto-2",
        storageBucket: "monitoria-projeto-2.appspot.com",
        messagingSenderId: "681394637170",
        appId: "1:681394637170:web:747c7b6c7c32beef78b5eb"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth();

    async function buscarAmigosPorEmail(email) {
        const q = query(collection(db, "InforConta"), where("email", "==", email));
        const querySnapshot = await getDocs(q);

        document.getElementById("lista-amigos").innerHTML = "";
        querySnapshot.forEach((doc) => {
            const userData = doc.data();
            renderizarAmigo(userData, doc.id);
        });
    }

    function renderizarAmigo(userData, userId) {
        const amigosSection = document.getElementById("lista-amigos");

        const amigoHTML = `
        <section class="amigo">
            <img src="${userData.fotoPerfil || '../Recursos/Imagens/perfil-teste.avif'}" alt="Foto de perfil" class="img-perfil">
            <section class="informacao">
                <p id="nome">${userData.nome}</p>
            </section>
            <a href="#"><button type="button" class="adicionar" data-uid="${userId}">Adicionar</button></a>
        </section>
    `;

    amigosSection.innerHTML += amigoHTML;

    document.querySelectorAll('.adicionar').forEach(button => {
        button.addEventListener('click', async (e) => {
            const amigoId = e.target.getAttribute('data-uid');
            const userId = auth.currentUser.uid;
            if (amigoId) {
                await adicionarAmigo(userId, amigoId);
            } else {
                alert("Erro ao adicionar amigo.");
            }
        });
    });
}

async function adicionarAmigo(userId, amigoId) {
    const userDoc = doc(db, "InforConta", userId);
    await updateDoc(userDoc, {
        listaAmigos: arrayUnion(amigoId)
    });
}
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('botao-pesquisa').addEventListener('click', function() {
        const email = document.getElementById('barra-pesquisa').value;
        if (email) {
            buscarAmigosPorEmail(email);
        } else {
            alert("Por favor, insira um email.");
        }
    });
});
</script>
<link rel="stylesheet" href="../Styles/estilo_tela-de-amigos.css">
<body>
    <header id="barra-superior">
        <section class="container-pesquisa">
            <input type="text" id="barra-pesquisa" placeholder="Procurar amigos por e-mail..." name="buscarAmigo">
            <button id="botao-pesquisa" name="pesquisar">Pesquisar</button>
        </section>
    </header>

    <main>
        <section id="lista-amigos"></section>
    </main>
</body>